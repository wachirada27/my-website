<!doctype html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>GPS Tracking | CPE x Drive Safety</title>

<link rel="icon" href="../img/icon.png">
<link rel="stylesheet" href="../CSS/style.css">

<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

<style>
#map{
  width:100%;
  height:calc(100vh - 140px);
  border-radius:20px;
  margin-top:80px;
  box-shadow:0 20px 40px rgba(0,0,0,.2);
}

.truck-icon{
  width:26px;
  height:26px;
  border-radius:50%;
  border:4px solid white;
  box-shadow:0 0 15px rgba(0,0,0,.4);
}
.green{ background:#2ee6a6; }
.orange{ background:#ff9800; }
.red{ background:#e53935; }
</style>
</head>

<body>
<div class="app">

<aside>
        <a href="index.html">Dashboard</a>
        <a href="map.html">GPS Tracking</a>
        <a href="drivers.html">Drivers</a>
        <a href="reports.html">Reports</a>
        <a href="settings.html">Settings</a>
</aside>

<header>
  <div class="logo">
    <img src="../img/icon.png">
    <span>CPE x Drive Safety</span>
  </div>
</header>

<main>
<h1 style="margin-top:90px;color:#1b5e4b">GPS Tracking</h1>
<div id="map"></div>
</main>

</div>

<script>
// ‡πÇ‡∏ü‡∏Å‡∏±‡∏™‡∏ó‡∏µ‡πà‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä
var map = L.map('map').setView([14.9799, 102.0977], 10);

L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{
  maxZoom:18
}).addTo(map);

// ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏£‡∏ñ 8 ‡∏Ñ‡∏±‡∏ô (‡πÇ‡∏Ñ‡∏£‡∏≤‡∏ä)
var trucks = [
 {plate:"1‡∏Å‡∏Ç-1001", driver:"‡∏≠.‡∏™‡∏ô‡∏±‡πà‡∏ô", time:2.2, lat:14.99, lng:102.10}, 
 {plate:"1‡∏Å‡∏Ç-1002", driver:"‡∏™‡∏≤‡∏¢‡∏ù‡∏ô", time:3.4, lat:14.97, lng:102.05}, 
 {plate:"1‡∏Å‡∏Ç-1003", driver:"‡∏Å‡∏¥‡∏ï‡∏ï‡∏¥‡∏û‡∏á‡∏©‡πå", time:4.5, lat:15.02, lng:102.12}, 
 {plate:"1‡∏Å‡∏Ç-1004", driver:"‡∏≠‡∏≤‡∏£‡∏µ‡∏¢‡∏≤", time:1.8, lat:14.95, lng:102.08}, 
 {plate:"1‡∏Å‡∏Ç-1005", driver:"‡∏≠.‡∏õ‡∏±‡∏ç‡∏ç‡∏≤", time:3.8, lat:15.01, lng:102.00}, 
 {plate:"1‡∏Å‡∏Ç-1006", driver:"‡∏≠.‡∏ò‡∏£‡∏£‡∏°‡∏Å‡∏£", time:5.1, lat:14.93, lng:102.15}, 
 {plate:"1‡∏Å‡∏Ç-1007", driver:"‡∏û‡∏á‡∏®‡∏ò‡∏£", time:2.9, lat:14.98, lng:102.18}, 
 {plate:"1‡∏Å‡∏Ç-1008", driver:"‡∏ß‡∏ä‡∏¥‡∏£‡∏î‡∏≤", time:4.2, lat:15.05, lng:102.09}
];

// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏à‡∏≤‡∏Å‡πÄ‡∏ß‡∏•‡∏≤‡∏Ç‡∏±‡∏ö
function getColor(time){
  if(time < 3) return "green";
  if(time < 4) return "orange";
  return "red";
}

// ‡∏ß‡∏≤‡∏á Marker ‡∏£‡∏ñ
trucks.forEach(t=>{
  var color = getColor(t.time);

  var icon = L.divIcon({
    className: "",
    html:`<div class="truck-icon ${color}"></div>`,
    iconSize:[30,30]
  });

  var status =
    t.time < 3 ? "üü¢ ‡∏õ‡∏Å‡∏ï‡∏¥" :
    t.time < 4 ? "üü† ‡πÉ‡∏Å‡∏•‡πâ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î" :
    "üî¥ ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î";

  L.marker([t.lat, t.lng], {icon:icon}).addTo(map)
   .bindPopup(`
     <b>üöö ${t.plate}</b><br>
     üë§ ${t.driver}<br>
     ‚è± ${t.time} ‡∏ä‡∏°.<br>
     ${status}
   `);
});
</script>

</body>
</html>
